%% Automate Importing Data by Generating Code Using the Database Explorer App
% This code reproduces the data obtained using the Database Explorer app by
% connecting to a database, executing a SQL query, and importing data into the
% MATLAB(R) workspace. To use this code, add the password for connecting to the
% database in the database command.

% Auto-generated by MATLAB (R2021b) and Database Toolbox Version 10.2 on 01-Dec-2021 17:06:14

%% Make connection to database
conn = database('Server97','sa','');

%Set query to execute on the database
query = ['SELECT StoricoAnalogiche.DataMisura, StoricoAnalogiche.Count,  StoricoAnalogiche.Cod7 ' ...
    'FROM ( IOTSmartOSS_HistoricDB.dbo.StoricoAnalogiche ' ...
    'INNER JOIN IOTSmartOSS_HistoricDB.dbo.Tab7 ' ...
    'ON StoricoAnalogiche.Cod7 = Tab7.ID) ' ...
    'WHERE StoricoAnalogiche.Cod7 IN (SELECT Tab7.ID where StoricoAnalogiche.Cod7 = 173 or StoricoAnalogiche.Cod7= 180 or StoricoAnalogiche.Cod7= 187 or StoricoAnalogiche.Cod7=460 or StoricoAnalogiche.Cod7=424 or StoricoAnalogiche.Cod7=464 or StoricoAnalogiche.Cod7=465 or StoricoAnalogiche.Cod7= 186 or StoricoAnalogiche.Cod7= 185 or StoricoAnalogiche.Cod7= 184) ' ...
    'and StoricoAnalogiche.Tag like (''%.1021.%'') and StoricoAnalogiche.DataMisura > ''2021-05-01 01:00:00.000'' and StoricoAnalogiche.diag=0 and StoricoAnalogiche.severita >4 ' ...
    ' ' ...
    'UNION ' ...
    ' ' ...
    'SELECT StoricoDigitali.DataEvento AS DataMisura, StoricoDigitali.Stato AS Count,  StoricoDigitali.Cod7 ' ...
    ' ' ...
    'FROM ( IOTSmartOSS_HistoricDB.dbo.StoricoDigitali ' ...
    'INNER JOIN IOTSmartOSS_HistoricDB.dbo.Tab7 ' ...
    'ON StoricoDigitali.Cod7 = Tab7.ID) ' ...
    'WHERE StoricoDigitali.Cod7 IN (SELECT Tab7.ID where StoricoDigitali.Cod7 = 482) ' ...
    'and StoricoDigitali.Tag like (''%.1021.%'') and StoricoDigitali.DataEvento > ''2021-05-01 01:00:00.000'' and StoricoDigitali.diag=0 and StoricoDigitali.severita >4 ' ...
    ' ' ...
    'ORDER BY StoricoAnalogiche.DataMisura ASC'];

%% Execute query and fetch results
data = fetch(conn,query);

%% Close connection to database
close(conn)

%% Clear variables
clear conn query